# Sprints ADAF Dashboard Pro - 2025-10-10

Este archivo documenta los sprints funcionales para activar y validar el dashboard, de lo más básico a lo más avanzado. Se irá actualizando y consultando paso a paso.

---

## Sprint 1: Núcleo y navegación
- [ ] Validar carga, navegación y layout general
- [ ] Probar login/logout y flujos de usuario básico (si aplica)
- [ ] Verificar que los datos mock aparecen en los paneles principales (News, Markets, Academy)

---

### Sprint 1 - Validación: Markets

- [x] Navegación a /markets exitosa, sin links rotos.
- [x] Panel principal carga correctamente (ETF Market Overview).
- [x] Datos mock de ETF Flows y comparación BTC/ETH se muestran (fuente: endpoints `/api/read/etf/flow` y `/api/read/etf/flow2`).
- [x] Indicadores, tabla y exportación CSV funcionales.
- [x] No se detectan errores de UI ni de datos en la sección Markets.

> Validación realizada el 2025-10-10. Listo para avanzar a la siguiente sección o sprint.

---

### Sprint 1 - Validación: News

- [x] Endpoint `/api/read/news` implementado con mock data desde Prisma (NewsData).
- [x] Navegación y carga de la sección News exitosa.
- [x] Noticias mock se muestran correctamente, sin errores de UI ni links rotos.
- [x] Filtros y paginación funcionales (limit básico, impacto por defecto 'low').
- [ ] Mejorar mapeo de impacto/severity cuando se agregue a NewsData.

> Validación realizada el 2025-10-10. Listo para avanzar a la siguiente sección o sprint.

---

### Sprint 1 - Validación: Academy

- [x] Navegación y carga de la sección Academy exitosa.
- [x] Datos mock de lecciones, progreso y stats de usuario se muestran correctamente (mock en frontend).
- [x] Filtros, tabs y UI funcionales, sin errores ni links rotos.
- [ ] Integrar persistencia real en backend si se requiere en el futuro.

> Validación realizada el 2025-10-10. Sprint 1 completado: todas las secciones principales funcionan con mock data y sin errores críticos.

## Sprint 2: Ingesta y visualización de datos
- [ ] Probar endpoints de ingesta (news, signals, TVL, etc.) con mock data
- [ ] Validar que los datos nuevos se reflejan en el dashboard
- [ ] Revisar deduplicación y persistencia

---

### Sprint 2 - Validación: Ingesta y visualización de datos

- [x] Endpoints de ingesta y visualización (news, signals, TVL, derivatives, DQP, lineage, reports, onchain) accesibles y sin errores de UI en el dashboard.
- [x] Mock data visible en todos los módulos principales.
- [x] Persistencia y deduplicación de noticias validada (Prisma/DB mock).
- [x] Navegación y carga de secciones avanzadas (Derivatives, OnChain, DQP, Lineage, Reports) sin links rotos ni errores críticos.
- [x] Tests ejecutados: sólo warnings menores (archivos .d.ts faltantes en backups y variables no usadas en seed-mock), sin fallos funcionales.
- [ ] Mejorar warnings de build/test en siguientes sprints.

> Validación realizada el 2025-10-10. Listo para avanzar a Sprint 3.

## Sprint 3: Funcionalidad avanzada
- [ ] Activar y probar módulos avanzados: Reports, OnChain, Derivatives, DQP, Lineage
- [ ] Validar filtros, búsquedas, exportaciones y acciones de usuario
- [ ] Probar integración con agentes (LAV-ADAF) y flujos automáticos

---

### Sprint 3 - Validación: Funcionalidad avanzada

- [x] Navegación y carga de módulos avanzados: Reports, OnChain, Derivatives, DQP, Lineage.
- [x] Filtros, búsquedas, exportaciones y acciones de usuario funcionales en UI (mock data).
- [x] Integración básica con agentes (LAV-ADAF) visible en paneles y endpoints.
- [x] No se detectan errores críticos ni links rotos en módulos avanzados.
- [ ] Profundizar pruebas automáticas y flujos automáticos en siguientes sprints.

> Validación realizada el 2025-10-10. Listo para avanzar a Sprint 4 (calidad, errores y demo).

## Sprint 4: Calidad, errores y demo
- [ ] Ejecutar todos los tests y corregir fallos
- [ ] Revisar logs, estados de error y mensajes al usuario
- [ ] Preparar scripts de demo y documentación para inversionistas

---

### Sprint 4 - Validación: TVL ingestion y DeFiLlama (10/10/2025)

- [x] Endpoint `/api/ingest/onchain/tvl` corregido para aceptar ambos formatos (`tvl`/`change24h`/`timestamp` y `value`/`ts`), deduplicar, generar alertas por caídas (>12%) usando `change24h`, y responder con el shape/status esperado para integración DeFiLlama.
- [x] Todos los tests de `tests/tvl.ingestion.test.ts` pasan (6/6): deduplicación, validación, alertas y batch.
- [x] Se ejecutó `pnpm test` y los tests de TVL, deduplicación y adapters pasan sin errores. El sistema está listo para demo en este módulo.

> Validación realizada el 2025-10-10. Siguiente: continuar con módulos pendientes y documentar avances.

---

> Actualizado: 2025-10-10
> Consultar y actualizar este archivo en cada sesión para mantener el contexto y el avance.

---

## Sprint 5: Sim-only nuevas unidades cuantitativas (2025-10-14)

### Objetivo

Activar en modo simulación los módulos Blockspace, Vaults LAV, Alpha Factory 2.0, Vol Pro, Event Alpha, Market Making selectivo, Transaction Cost Analysis, Cosmos Executor y Liquidity Backstop con control total por Feature Flags + RBAC, layout drag & drop, i18n ES-MX, métricas Prometheus, pruebas automatizadas y runbooks Fortune 500.

### Guardrails operativos

- Ejecución en dry-run obligatoria (sin side effects ni órdenes reales).
- Manejo de secretos mediante `src/lib/config/*` + `.env.*` (sin strings mágicos).
- Logging estructurado JSON usando `logger.ts`, siempre con `x-correlation-id`.
- Endpoints nuevos protegidos con `withSecurityHeaders`, `withRateLimit`, `cache-middleware` y respuesta `X-Data: stale` en fallback.
- Rate limits y circuit breakers definidos para cada API crítica.
- Métricas exportadas a Prometheus (counters/gauges/histogramas) listas para Grafana/SLO.

### Definition of Done

- Widgets operables sólo cuando el Feature Flag correspondiente esté activo (FF + RBAC en cliente/servidor).
- Cobertura mínima: 75% líneas / 70% branches por módulo (unit + API + e2e en ADAF, LAV-ADAF y backups).
- Dashboards en Grafana actualizados con métricas nuevas y SLO documentados.
- Evidencias en `evidence/v1.5/` + runbooks en `docs/runbooks/` enlazados desde `RUNBOOK.md`.
- Lint sin warnings y `pnpm test`/`pnpm build` verdes.

### Panorama rápido y brechas actuales

- **Blockspace**: existen `rebates.ts`, `relays.ts`, `sequencer.ts`; faltan `builder.ts`, `desk.ts` y endpoints `/api/blockspace/{quote,bundle}`. Requiere expansión sin duplicar lógica de `routes/`.
- **Layout drag & drop**: `DashboardLayoutContext` y `DashboardLayoutContainer` manejan lanes actuales. Hay que ampliar `DEFAULT_LAYOUT`, `COMPONENT_MAP`, rutas de navegación (`NavLeft`) y clonar cambios en `dashboard-backup` y `lav-adaf/apps/dashboard*`.
- **Feature flags**: `featureFlags.ts` sólo expone dos flags. Debemos agregar todas las llaves `NEXT_PUBLIC_FF_*`, propagar a `.env.*`, hooks, componentes y API. Añadir pruebas (ver `wsp.featureFlag.test.ts`).
- **RBAC**: catálogo limitado. Extender permisos `feature:{blockspace,vaults,...}` en contexto y guards de server (`auth.rbac.test.ts`). Documentar permisos nuevos.
- **Prometheus**: sólo `wsp.metrics.ts` con contadores genéricos. Crear métricas específicas por módulo reutilizando patrones existentes.
- **Guardrails resiliencia**: nuevas rutas deben usar middlewares existentes y emitir `X-Data: stale` cuando cachee.
- **i18n ES-MX**: no hay infraestructura. Definir adopción de `next-intl` (o estrategia equivalente) sin romper App Router (layouts por locale, carpetas `messages/es-MX`).
- **Repos duplicados**: suites de tests deben replicarse en `tests/`, `lav-adaf/apps/dashboard/tests/` y `lav-adaf/apps/dashboard-backup/tests/`.
- **Documentación**: localizar runbooks/evidencias en `docs/` + `evidence/` y enlazarlos desde `README.md` y Grafana.
- **Configuración**: integrar `EXECUTION_MODE` y flags similares en `src/lib/config/` + `.env`. Evitar strings mágicos en componentes.
- **Sincronización LAV-ADAF**: cada librería nueva debe exponerse también en `lav-adaf/` (API mocks/adapters), manteniendo paridad de interfaz.

### Backlog propuesto

1. **Fundamentos**
   - Crear estructura de carpetas: `src/lib/{blockspace,vaults,alpha,allocator,volpro,events,mm,tca,cosmos,liquidity}/` replicando patrón actual.
   - Generar endpoints API correspondientes (`src/app/api/...` + mocks en `lav-adaf/apps/dashboard/api/...`) usando middlewares de seguridad.
   - Extender Feature Flags (`featureFlags.ts`, `.env.*`, hooks) y RBAC (contexto + server guards + tests).
   - Añadir infraestructura i18n (`next-intl` o equivalente): provider en `src/app/(dashboard)/layout.tsx`, archivos `messages/es-MX.json`, adaptaciones en componentes críticos.

2. **UI y Layout**
   - Actualizar `DashboardLayoutContext` y `DashboardLayoutContainer` con nuevos lanes/widgets y drag & drop persistente.
   - Ajustar `NavLeft`, PageGuide y duplicados en `dashboard-backup`/`lav-adaf`.
   - Crear widgets en ADAF + LAV (cards, charts) con soporte ES-MX y toggles por flag.

3. **Observabilidad y guardrails**
   - Exportar métricas específicas en `wsp.metrics.ts` (o submódulos) y dashboards Grafana.
   - Configurar logs JSON con `logger.ts` en nuevos servicios, incluyendo `x-correlation-id`.
   - Añadir rate limits/circuit breakers por endpoint y pruebas negativas.

4. **Testing y documentación**
   - Suites unitarias/API/e2e para cada módulo (ADAF, LAV, backups) garantizando la cobertura mínima.
   - Actualizar runbooks (`docs/runbooks/*.md`), playbooks operativos y evidencias (`evidence/v1.5/`).
   - Validar `pnpm lint`, `pnpm test`, `pnpm build`, scripts de smoke (`./inicio-servidor.sh --smoke`).

### Métricas y entregables

- Cobertura ≥75/70 reportada en CI y documentada en evidencias.
- Panel Grafana con métricas por módulo y SLO firmados.
- Registro de FF/RBAC en `docs/security/` o equivalente.
- Checklist de publicación para submódulo `lav-adaf` (credenciales con scope `workflow`).
- Actualización de `README.md`, `MEMORIA_GITHUB_COPILOT.md` y `SPRINTS_2025-10-10.md` con resultados al cierre del sprint.

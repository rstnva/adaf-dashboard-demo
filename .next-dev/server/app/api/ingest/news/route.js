(()=>{var a={};a.id=3780,a.ids=[3780],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:a=>{"use strict";a.exports=require("assert")},14985:a=>{"use strict";a.exports=require("dns")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:a=>{"use strict";a.exports=require("os")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},34198:(a,b,c)=>{"use strict";c.d(b,{z:()=>e});var d=c(96330);let e=globalThis.prisma||new d.PrismaClient({log:["query","info","warn","error"]})},34631:a=>{"use strict";a.exports=require("tls")},41204:a=>{"use strict";a.exports=require("string_decoder")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},44941:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>K,patchFetch:()=>J,routeModule:()=>F,serverHooks:()=>I,workAsyncStorage:()=>G,workUnitAsyncStorage:()=>H});var d={};c.r(d),c.d(d,{POST:()=>E});var e=c(70818),f=c(73659),g=c(27002),h=c(69532),i=c(40386),j=c(261),k=c(8404),l=c(92638),m=c(35254),n=c(92229),o=c(53203),p=c(29865),q=c(25183),r=c(7896),s=c(86439),t=c(15974),u=c(20554),v=c(55511),w=c.n(v),x=c(78669),y=c(34198),z=c(41315);function A(a){let b=new Date(a.published_at).toISOString(),c=`${a.source}|${a.title.trim().toLowerCase()}|${a.url}|${b}`;return w().createHash("sha256").update(c).digest("hex")}function B(a){let b=`${a.title} ${a.summary||""}`.toLowerCase();return["hack","exploit","breach","depeg","halt"].some(a=>b.includes(a))?{severity:"high"}:["sec","cnbv","banxico","cpi","fomc","rate","etf"].some(a=>b.includes(a))?{severity:"med"}:{severity:"low"}}let C=u.Ik({source:u.Yj().min(1),title:u.Yj().min(1),url:u.Yj().url(),published_at:u.Yj().datetime(),category:u.Yj().optional(),summary:u.Yj().optional(),tickers:u.YO(u.Yj()).default([]),keywords:u.YO(u.Yj()).default([])});function D(a){return{title:a.title,summary:a.summary||a.description||"",url:a.url||a.link||a.feedUrl||"",published_at:a.published_at||a.pubDate||new Date().toISOString(),source:a.source||"Unknown",category:a.category||"",tickers:a.tickers||[],keywords:a.keywords||[]}}let E=async a=>{let b,c=(a.nextUrl?.pathname||a.url||"").endsWith("/news/rss"),d=await a.json();if(c)if(d&&(d.feedUrl||d.url)){let a=new Date().toISOString(),b=D({title:d.title||"Sample RSS",summary:d.summary||d.description||"Sample summary",url:d.url||d.feedUrl||"https://sample.com/rss",published_at:d.published_at||a,source:d.source||"RSS",tickers:d.tickers||[],keywords:d.keywords||[]}),c=A(b),e=B(b),f="high"===e.severity?"critical":e.severity;if(await y.z.newsData.findUnique({where:{link:b.url}}))return z.NextResponse.json({success:!1,error:"already exists",fingerprint:c,signalId:c},{status:409});let g={...b,success:!0,signalId:c,fingerprint:c,severity:f};return await y.z.newsData.create({data:{title:b.title,description:b.summary||"",link:b.url,pubDate:new Date(b.published_at),source:b.source,sentiment:0,keywords:b.keywords}}),z.NextResponse.json({success:!0,signalId:c,fingerprint:c,severity:f,signals:[g],processed:1,errors:[]},{status:200})}else{if(!Array.isArray(d))return z.NextResponse.json({success:!1,signalId:null,fingerprint:null,signals:[],processed:0,errors:["Invalid RSS payload"]},{status:400});let a=0,b=[],c=[],e=await (0,x.R)();for(let f of d)try{let d=D(f),g=C.parse(d),h=A(g);if(await e.setnx(`dedupe:news:${h}`,"1")){let c=B(g),d="high"===c.severity?"critical":c.severity;b.push({...g,fingerprint:h,signalId:h,severity:d,success:!0}),a++}else c.push({error:"already exists",fingerprint:h})}catch(a){c.push(a)}let f=null,g=null,h=null;return b.length>0?(f=b[0].signalId,g=b[0].fingerprint,h=b[0].severity):c.length>0&&c[0].fingerprint&&(f=c[0].fingerprint,g=c[0].fingerprint),z.NextResponse.json({success:b.length>0,signalId:f,fingerprint:g,severity:h,signals:b,processed:a,errors:c},{status:200})}if(Array.isArray(d)){let a=0,b=[],c=[];for(let e of d)try{let d=D(e),f=C.parse(d),g=A(f);if(await y.z.newsData.findUnique({where:{link:f.url}}))c.push({error:"already exists",fingerprint:g});else{let c=B(f),d="high"===c.severity?"critical":c.severity;b.push({...f,fingerprint:g,signalId:g,severity:d,success:!0}),a++,await y.z.newsData.create({data:{title:f.title,description:f.summary||"",link:f.url,pubDate:new Date(f.published_at),source:f.source,sentiment:0,keywords:f.keywords}})}}catch(a){c.push(a)}let e=null,f=null,g=null;return b.length>0?(e=b[0].signalId,f=b[0].fingerprint,g=b[0].severity):c.length>0&&c[0].fingerprint&&(e=c[0].fingerprint,f=c[0].fingerprint),z.NextResponse.json({success:b.length>0,signalId:e,fingerprint:f,severity:g,signals:b,processed:a,errors:c},{status:200})}try{let a=D(d);b=C.parse(a)}catch(a){return z.NextResponse.json({success:!1,error:"validation error",details:a.errors||a,signalId:null,fingerprint:null},{status:400})}let e=A(b);if(await y.z.newsData.findUnique({where:{link:b.url}}))return z.NextResponse.json({success:!1,error:"already exists",fingerprint:e,signalId:e},{status:409});let f=B(b),g="high"===f.severity?"critical":f.severity;return await y.z.newsData.create({data:{title:b.title,description:b.summary||"",link:b.url,pubDate:new Date(b.published_at),source:b.source,sentiment:0,keywords:b.keywords}}),z.NextResponse.json({success:!0,signalId:e,fingerprint:e,severity:g,...b},{status:201})},F=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/ingest/news/route",pathname:"/api/ingest/news",filename:"route",bundlePath:"app/api/ingest/news/route"},distDir:".next-dev",relativeProjectDir:"",resolvedPagePath:"/home/parallels/Desktop/adaf-dashboard-pro/src/app/api/ingest/news/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:G,workUnitAsyncStorage:H,serverHooks:I}=F;function J(){return(0,g.patchFetch)({workAsyncStorage:G,workUnitAsyncStorage:H})}async function K(a,b,c){var d;let e="/api/ingest/news/route";"/index"===e&&(e="/");let g=await F.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!E||F.isDev||x||(G="/index"===(G=C)?"/":G);let H=!0===F.isDev||!E,I=E&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>F.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>F.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await F.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await F.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await F.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},55511:a=>{"use strict";a.exports=require("crypto")},56161:()=>{},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78669:(a,b,c)=>{"use strict";c.d(b,{R:()=>h});let d=new Map;function e(){return Date.now()}let f={setnx:async(a,b)=>!d.has(a)&&(d.set(a,{v:b,exp:e()+864e5}),!0),async get(a){let b=d.get(a);return b?e()>b.exp?(d.delete(a),null):b.v:null},set:async(a,b)=>(d.set(a,{v:b,exp:e()+864e5}),"OK"),setex:async(a,b,c)=>(d.set(a,{v:c,exp:e()+1e3*b}),"OK"),async del(...a){let b=0;return a.forEach(a=>{d.delete(a)&&b++}),b},async ttl(a){let b=d.get(a);return b?Math.max(0,Math.floor((b.exp-e())/1e3)):-2},mget:async(...a)=>a.map(a=>{let b=d.get(a);return b?e()>b.exp?(d.delete(a),null):b.v:null}),smembers:async a=>[],sadd:async(a,b)=>1,async expire(a,b){let c=d.get(a);return c?(d.set(a,{v:c.v,exp:e()+1e3*b}),1):0},async keys(a){let b=RegExp("^"+a.replace("*",".*")+"$");return Array.from(d.keys()).filter(a=>b.test(a))},async scan(a,b,c,d,e){let f=await this.keys(c),g=parseInt(a,10)||0,h=f.slice(g,g+e);return[g+e>=f.length?"0":String(g+e),h]},pipeline(){let a=[];return{setex:(b,c,f)=>(a.push(()=>{d.set(b,{v:f,exp:e()+1e3*c})}),this),set:(b,c)=>(a.push(()=>{d.set(b,{v:c,exp:e()+864e5})}),this),sadd:(a,b)=>this,expire:(b,c)=>(a.push(()=>{let a=d.get(b);a&&d.set(b,{v:a.v,exp:e()+1e3*c})}),this),async exec(){a.forEach(a=>a())}}},ping:async()=>"PONG",info:async a=>"",dbsize:async()=>d.size},g=null;function h(a){if(g)return g;if("1"===process.env.MOCK_MODE)return g=f;try{let{default:b}=c(26627),d=process.env.REDIS_URL,e=new b(d||a);return e.on?.("error",a=>{}),e.on?.("connect",()=>{}),g=e}catch(a){return g=f}}},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},83997:a=>{"use strict";a.exports=require("tty")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{"use strict";a.exports=require("net")},92609:()=>{},94735:a=>{"use strict";a.exports=require("events")},96330:a=>{"use strict";a.exports=require("@prisma/client")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[246,6186,6674,8173,6627],()=>b(b.s=44941));module.exports=c})();
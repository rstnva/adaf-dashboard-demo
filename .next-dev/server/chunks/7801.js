"use strict";exports.id=7801,exports.ids=[7801],exports.modules={4508:(a,b,c)=>{c.d(b,{F:()=>i,T:()=>j});var d=c(4026),e=c(58563),f=c(86297),g=c(45159);let h=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=e.forwardRef(({className:a,variant:b,...c},e)=>(0,d.jsx)("div",{ref:e,role:"alert",className:(0,g.cn)(h({variant:b}),a),...c}));i.displayName="Alert";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",a),...b}));j.displayName="AlertDescription"},47801:(a,b,c)=>{c.d(b,{$:()=>B});var d=c(4026),e=c(58563),f=c.n(e),g=c(73359),h=c(16456),i=c(98906);let j=(0,c(7967).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var k=c(57262),l=c(92564),m=c(1140),n=c(94139),o=c(48396),p=c(46555);let q=({open:a,children:b})=>(0,d.jsx)("div",{"data-state":a?"open":"closed",children:b}),r=e.forwardRef(({children:a,...b},c)=>(0,d.jsx)("button",{ref:c,...b,children:a}));r.displayName="CollapsibleTrigger";let s=e.forwardRef(({children:a,...b},c)=>(0,d.jsx)("div",{ref:c,...b,children:a}));s.displayName="CollapsibleContent";var t=c(45159);function u({className:a,...b}){return(0,d.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-slate-100",a),...b})}var v=c(4508),w=c(2756);function x({data:a,className:b="",maxHeight:c="300px"}){let e=f().useMemo(()=>{try{return JSON.stringify(a,null,2)}catch(a){return`Error formatting JSON: ${a instanceof Error?a.message:"Unknown error"}`}},[a]);return(0,d.jsx)("div",{className:`bg-slate-50 border rounded-md p-3 ${b}`,style:{maxHeight:c,overflowY:"auto"},children:(0,d.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap text-slate-800 leading-relaxed",children:e})})}async function y(a,b="Copiado al portapapeles"){try{if(navigator?.clipboard?.writeText){await navigator.clipboard.writeText(a);let c=document.createElement("div");return c.className="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg z-50 transition-all duration-300",c.textContent=b,document.body.appendChild(c),setTimeout(()=>{c.style.opacity="0",setTimeout(()=>document.body.removeChild(c),300)},2e3),!0}{let c=document.createElement("textarea");c.value=a,c.style.position="fixed",c.style.left="-999999px",c.style.top="-999999px",document.body.appendChild(c),c.focus(),c.select();let d=document.execCommand("copy");if(document.body.removeChild(c),d){let a=document.createElement("div");a.className="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg z-50",a.textContent=b,document.body.appendChild(a),setTimeout(()=>document.body.removeChild(a),2e3)}return d}}catch(b){console.error("Failed to copy to clipboard:",b);let a=document.createElement("div");return a.className="fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-md shadow-lg z-50",a.textContent="Error al copiar",document.body.appendChild(a),setTimeout(()=>document.body.removeChild(a),2e3),!1}}function z(a,b=6,c=4){return!a||a.length<=b+c+3?a:`${a.substring(0,b)}…${a.substring(a.length-c)}`}let A={ingest:{color:"bg-blue-100 text-blue-800 border-blue-200",icon:"\uD83D\uDCE5",label:"Ingesta"},transform:{color:"bg-purple-100 text-purple-800 border-purple-200",icon:"\uD83D\uDD04",label:"Transformaci\xf3n"},aggregate:{color:"bg-teal-100 text-teal-800 border-teal-200",icon:"\uD83D\uDCCA",label:"Agregaci\xf3n"},export:{color:"bg-gray-100 text-gray-800 border-gray-200",icon:"\uD83D\uDCE4",label:"Exportaci\xf3n"}};function B({open:a,onClose:b,entity:c,refId:e}){let{data:f,isLoading:k,isError:l,error:m,refetch:q}=function({entity:a,refId:b,enabled:c=!0}){return(0,w.I)({queryKey:["lineage","trace",a,b],queryFn:async()=>{if(!("string"==typeof a&&["signal","metric","report"].includes(a)))throw Error(`Invalid entity: ${a}. Must be signal, metric, or report`);if(!b||0===b.trim().length)throw Error("refId is required and cannot be empty");let c=new URLSearchParams({entity:a,refId:b.trim()}),d=await fetch(`/api/read/lineage/trace?${c}`,{headers:{"Content-Type":"application/json"}});if(!d.ok)throw Error((await d.json().catch(()=>({}))).error||`HTTP ${d.status}: Failed to fetch lineage trace`);let e=await d.json();if(!e.success)throw Error(e.error||"Failed to fetch lineage trace");return e},enabled:c&&!!a&&!!b,staleTime:3e4,retry:(a,b)=>!(b.message.includes("Invalid entity")||b.message.includes("HTTP 4"))&&a<2})}({entity:c,refId:e,enabled:a}),r=async a=>{await y(a,"Hash copiado al portapapeles")},s=async()=>{await y(e,"ID de referencia copiado")},t=z(e,8,6);return(0,d.jsx)(n.cj,{open:a,onOpenChange:b,children:(0,d.jsxs)(n.h,{className:"w-full sm:w-[540px] md:w-[640px] lg:w-[720px] max-w-none overflow-y-auto","aria-describedby":"lineage-drawer-description",children:[(0,d.jsxs)(n.Fm,{className:"space-y-3 pb-4 border-b",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(n.qp,{className:"flex items-center gap-2 text-lg",children:[(0,d.jsx)(g.A,{className:"w-5 h-5 text-slate-600"}),"Lineage"]}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",onClick:b,className:"h-8 w-8 p-0",children:(0,d.jsx)(h.A,{className:"w-4 h-4"})})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,d.jsx)(p.E,{variant:"outline",className:"capitalize",children:c}),(0,d.jsx)(i.A,{className:"w-3 h-3"}),(0,d.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:s,className:"h-auto p-1 font-mono text-xs hover:bg-slate-100",children:[t,(0,d.jsx)(j,{className:"w-3 h-3 ml-1"})]})]})]}),(0,d.jsxs)("div",{id:"lineage-drawer-description",className:"sr-only",children:["Visualizaci\xf3n del lineage completo para ",c," con ID ",e,". Use las teclas de navegaci\xf3n para explorar los eventos y ESC para cerrar."]}),(0,d.jsxs)("div",{className:"py-4",children:[k&&(0,d.jsx)(E,{}),l&&(0,d.jsx)(v.F,{className:"mb-4",children:(0,d.jsxs)(v.T,{className:"flex items-center justify-between",children:[(0,d.jsxs)("span",{children:["Error al cargar lineage:"," ",m?.message||"Error desconocido"]}),(0,d.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>q(),children:"Reintentar"})]})}),f?.success&&f.trace&&(0,d.jsx)(C,{events:f.trace.events,onCopyHash:r}),f?.success&&(!f.trace||0===f.trace.events.length)&&(0,d.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,d.jsx)(g.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,d.jsx)("p",{children:"No se encontraron eventos de lineage para esta entidad."})]})]}),(0,d.jsx)("div",{className:"border-t pt-4 mt-6",children:(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[(0,d.jsx)("span",{children:f?.success&&f.trace&&(0,d.jsxs)(d.Fragment,{children:[f.trace.events.length," eventos • \xdaltima actualizaci\xf3n:"," ",(a=>{try{return new Date(a).toLocaleString("es-ES",{dateStyle:"short",timeStyle:"medium"})}catch{return a}})(f.trace.lastEventAt)]})}),(0,d.jsx)(o.$,{variant:"outline",size:"sm",onClick:b,children:"Cerrar"})]})})]})})}function C({events:a,onCopyHash:b}){let c=f().useMemo(()=>[...a].sort((a,b)=>new Date(a.ts).getTime()-new Date(b.ts).getTime()),[a]);return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("h3",{className:"font-medium text-slate-900 flex items-center gap-2",children:[(0,d.jsx)(k.A,{className:"w-4 h-4"}),"Timeline de procesamiento (",c.length," eventos)"]}),(0,d.jsxs)("ul",{className:"space-y-4 relative",children:[(0,d.jsx)("div",{className:"absolute left-6 top-4 bottom-4 w-px bg-slate-200"}),c.map(a=>(0,d.jsx)(D,{event:a,onCopyHash:b},`${a.id}-${a.ts}`))]})]})}function D({event:a,onCopyHash:b}){let[c,e]=f().useState(!1),g=A[a.stage],h=a.inputs&&Object.keys(a.inputs).length>0||a.outputs&&Object.keys(a.outputs).length>0;return(0,d.jsxs)("li",{className:"relative pl-12",children:[(0,d.jsx)("div",{className:`
        absolute left-4 w-4 h-4 rounded-full border-2 bg-white
        ${g.color.includes("blue")?"border-blue-400":""}
        ${g.color.includes("purple")?"border-purple-400":""}
        ${g.color.includes("teal")?"border-teal-400":""}
        ${g.color.includes("gray")?"border-gray-400":""}
      `}),(0,d.jsxs)("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[(0,d.jsx)("div",{className:"flex items-start justify-between gap-3 mb-3",children:(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsxs)(p.E,{className:`${g.color} text-xs`,children:[g.icon," ",g.label]}),(0,d.jsx)("span",{className:"text-xs text-slate-500",children:(a=>{try{return new Date(a).toLocaleString("es-ES",{dateStyle:"short",timeStyle:"medium"})}catch{return a}})(a.ts)})]}),(0,d.jsxs)("div",{className:"text-sm",children:[(0,d.jsx)("span",{className:"font-medium text-slate-700",children:"Fuente:"}),(0,d.jsx)("span",{className:"ml-2 font-mono text-xs bg-slate-50 px-2 py-1 rounded",children:a.source})]})]})}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-3 text-xs",children:[(0,d.jsx)("span",{className:"text-slate-500",children:"Hash:"}),(0,d.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:()=>b(a.hash),className:"h-auto p-1 font-mono text-xs hover:bg-slate-100",children:[z(a.hash),(0,d.jsx)(j,{className:"w-3 h-3 ml-1"})]})]}),a.notes&&(0,d.jsxs)("div",{className:"text-xs text-slate-600 mb-3 p-2 bg-slate-50 rounded",children:[(0,d.jsx)("strong",{children:"Notas:"})," ",a.notes]}),h&&(0,d.jsxs)(q,{open:c,onOpenChange:e,children:[(0,d.jsxs)(r,{onClick:()=>e(!c),className:"h-auto p-2 text-xs w-full justify-between hover:bg-slate-50 flex items-center rounded border bg-white",children:[(0,d.jsx)("span",{children:"Ver inputs/outputs"}),c?(0,d.jsx)(l.A,{className:"w-3 h-3"}):(0,d.jsx)(m.A,{className:"w-3 h-3"})]}),(0,d.jsxs)(s,{className:"mt-3 space-y-3",children:[a.inputs&&Object.keys(a.inputs).length>0&&(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"text-xs font-medium text-slate-700 mb-2",children:"Inputs:"}),(0,d.jsx)(x,{data:a.inputs,maxHeight:"200px"})]}),a.outputs&&Object.keys(a.outputs).length>0&&(0,d.jsxs)("div",{children:[(0,d.jsx)("h5",{className:"text-xs font-medium text-slate-700 mb-2",children:"Outputs:"}),(0,d.jsx)(x,{data:a.outputs,maxHeight:"200px"})]})]})]})]})]})}function E(){return(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,d.jsx)(k.A,{className:"w-4 h-4 text-slate-400"}),(0,d.jsx)(u,{className:"h-4 w-32"})]}),Array.from({length:3},(a,b)=>(0,d.jsxs)("div",{className:"relative pl-12",children:[(0,d.jsx)("div",{className:"absolute left-4 w-4 h-4 rounded-full bg-slate-200"}),(0,d.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,d.jsx)(u,{className:"h-5 w-20"}),(0,d.jsx)(u,{className:"h-4 w-24"})]}),(0,d.jsx)(u,{className:"h-4 w-full mb-2"}),(0,d.jsx)(u,{className:"h-4 w-3/4"})]})]},b))]})}},94139:(a,b,c)=>{c.d(b,{CG:()=>i,Fm:()=>m,Qs:()=>o,cj:()=>h,h:()=>l,qp:()=>n});var d=c(4026);c(58563);var e=c(78122),f=c(16456),g=c(45159);function h({...a}){return(0,d.jsx)(e.bL,{"data-slot":"sheet",...a})}function i({...a}){return(0,d.jsx)(e.l9,{"data-slot":"sheet-trigger",...a})}function j({...a}){return(0,d.jsx)(e.ZL,{"data-slot":"sheet-portal",...a})}function k({className:a,...b}){return(0,d.jsx)(e.hJ,{"data-slot":"sheet-overlay",className:(0,g.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...b})}function l({className:a,children:b,side:c="right",...h}){return(0,d.jsxs)(j,{children:[(0,d.jsx)(k,{}),(0,d.jsxs)(e.UC,{"data-slot":"sheet-content",className:(0,g.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===c&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===c&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===c&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===c&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",a),...h,children:[b,(0,d.jsxs)(e.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,d.jsx)(f.A,{className:"size-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m({className:a,...b}){return(0,d.jsx)("div",{"data-slot":"sheet-header",className:(0,g.cn)("flex flex-col gap-1.5 p-4",a),...b})}function n({className:a,...b}){return(0,d.jsx)(e.hE,{"data-slot":"sheet-title",className:(0,g.cn)("text-foreground font-semibold",a),...b})}function o({className:a,...b}){return(0,d.jsx)(e.VY,{"data-slot":"sheet-description",className:(0,g.cn)("text-muted-foreground text-sm",a),...b})}}};
exports.id=4903,exports.ids=[4903],exports.modules={53203:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(13451),e=c(11674),f=c(29865);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},53307:(a,b,c)=>{"use strict";let d;c.d(b,{Ot:()=>n,Qq:()=>e,V6:()=>j,WL:()=>o,Zl:()=>m,m8:()=>l,uT:()=>k});let e={adapterRequests:0,wspsScore:0,eventsTotal:0,cacheHits:0,apiHits:0,integrationsClicks:0},f=!1,g={},h={},i={};try{let a=c(50029);d=a.register,g.adapterRequests=new a.Counter({name:"wsp_adapter_requests_total",help:"Total adapter requests",labelNames:["adapter","status"]}),g.apiHits=new a.Counter({name:"wsp_api_hits_total",help:"Total API hits for WSP routes",labelNames:["route","status"]}),g.cacheHits=new a.Counter({name:"wsp_cache_hits_total",help:"Cache hits in WSP adapters",labelNames:["source"]}),g.eventsTotal=new a.Counter({name:"wsp_events_total",help:"Total WSP notable events"}),g.integrationsClicks=new a.Counter({name:"wsp_integrations_click_total",help:"Integration widget clicks",labelNames:["provider","widget"]}),h.wspsScore=new a.Gauge({name:"wsp_wsps_score",help:"Latest WSPS score value"}),i.adapterLatency=new a.Histogram({name:"wsp_adapter_latency_seconds",help:"Adapter latency seconds",labelNames:["adapter"],buckets:[.05,.1,.2,.5,1,2,5]}),i.apiLatency=new a.Histogram({name:"wsp_api_latency_seconds",help:"API route latency seconds",labelNames:["route"],buckets:[.01,.05,.1,.2,.5,1,2]}),f=!0}catch{f=!1}function j(a,b,c){e.apiHits++,f&&g.apiHits&&g.apiHits.inc({route:a||"unknown",status:String(b||0)}),f&&i.apiLatency&&a&&"number"==typeof c&&i.apiLatency.observe({route:a},c/1e3)}function k(a){e.wspsScore=a,f&&h.wspsScore&&h.wspsScore.set(a)}function l(a,b,c){e.adapterRequests++,f&&g.adapterRequests&&g.adapterRequests.inc({adapter:a||"unknown",status:String(b||0)}),f&&i.adapterLatency&&a&&"number"==typeof c&&i.adapterLatency.observe({adapter:a},c/1e3)}function m(a="redis"){e.cacheHits++,f&&g.cacheHits&&g.cacheHits.inc({source:a})}function n(a,b){e.integrationsClicks++,f&&g.integrationsClicks&&g.integrationsClicks.inc({provider:a,widget:b})}async function o(){return f&&d?await d.metrics():null}},53452:(a,b,c)=>{"use strict";c.d(b,{EQ:()=>l,IT:()=>k,NF:()=>i,Rn:()=>e,YV:()=>g,jb:()=>j});let d=new Map,e={async get(a){{let b=d.get(a);return b?Date.now()>b.exp?(d.delete(a),null):b.v:null}},async set(a,b,c){d.set(a,{v:b,exp:Date.now()+1e3*c})},async del(a){d.delete(a)}},f=new Map;function g(a,b,c){let d=Date.now(),e=f.get(a);e||(e={tokens:c,lastRefill:d},f.set(a,e));let g=(d-e.lastRefill)/1e3;return e.tokens=Math.min(c,e.tokens+g*b),e.lastRefill=d,e.tokens>=1&&(e.tokens-=1,!0)}let h=new Map;function i(a){let b=h.get(a);return!b||!("open"===b.state&&Date.now()<b.nextTry)&&("open"===b.state&&Date.now()>=b.nextTry&&(b.state="half-open",h.set(a,b)),!0)}function j(a){h.set(a,{state:"closed",failures:0,nextTry:0})}function k(a,b=1e3){let c=(h.get(a)||{state:"closed",failures:0,nextTry:0}).failures+1,d=Math.min(6e4,b*Math.pow(2,c))+Math.floor(250*Math.random()),e=Date.now()+d;h.set(a,{state:c>=3?"open":"closed",failures:c,nextTry:e})}async function l(a,b,c,d,f={}){let g=`${c}:etag`,h=await e.get(g),i=new Headers(f);h&&i.set("If-None-Match",h);try{let a=await fetch(b,{headers:i}),f=a.status;if(304===f){let a=await e.get(c);if(a)return{body:a,status:f,stale:!1}}if(!a.ok)throw Error(`HTTP ${f}`);let h=await a.text(),j=a.headers.get("etag");return await e.set(c,h,d),j&&await e.set(g,j,d),{body:h,status:f,stale:!1}}catch(b){let a=await e.get(c);if(a)return{body:a,status:200,stale:!0};throw b}finally{}}},56161:()=>{},57849:(a,b,c)=>{"use strict";c.d(b,{Jt:()=>h,dE:()=>k,g5:()=>j,qk:()=>i,uq:()=>g});var d=c(53452);let e={},f=(a,b)=>{};async function g(a){try{let b=await d.Rn.get(a);if(b)return JSON.parse(b)}catch(a){f("Failed to read stats from Redis",a)}let b=e[a];return b&&b.exp>Date.now()?b.value:null}async function h(a,b){let c=JSON.stringify(b);try{await d.Rn.set(a,c,86400)}catch(a){f("Failed to write stats to Redis",a)}e[a]={value:b,exp:Date.now()+864e5}}let i={vix:"wsp:norm:vix:stats",dxy:"wsp:norm:dxy:stats",etfBtc:"wsp:norm:etf:btc:p5p95",etfEth:"wsp:norm:etf:eth:p5p95"};async function j(a){try{let b=await d.Rn.get(a);if(b)return JSON.parse(b)}catch(a){f("Failed to read percentiles from Redis",a)}let b=e[a];return b&&b.exp>Date.now()?b.value:null}async function k(a,b){let c=JSON.stringify(b);try{await d.Rn.set(a,c,86400)}catch(a){f("Failed to write percentiles to Redis",a)}e[a]={value:b,exp:Date.now()+864e5}}},58824:(a,b,c)=>{"use strict";function d(a,b){let c=a?.mean??0,d=a?.m2??0,e=(a?.count??0)+1,f=b-c,g=c+f/e;return{mean:g,m2:d+f*(b-g),count:e}}c.d(b,{BT:()=>f,DD:()=>d});class e{constructor(a,b){if(this.n=[1,2,3,4,5],this.q=[0,0,0,0,0],this.np=[0,0,0,0,0],this.dn=[0,0,0,0,0],this.initialized=!1,this.count=0,this.initial=[],a<=0||a>=1)throw Error("p must be in (0,1)");this.p=a,b&&this.fromSnapshot(b)}initFromFive(a){let b=[...a].sort((a,b)=>a-b);this.q=[b[0],b[1],b[2],b[3],b[4]],this.n=[1,2,3,4,5],this.np=[1,1+2*this.p,1+4*this.p,3+2*this.p,5],this.dn=[0,this.p/2,this.p,(1+this.p)/2,1],this.initialized=!0}update(a){let b;if(this.count+=1,!this.initialized){this.initial.push(a),5===this.initial.length&&(this.initFromFive(this.initial),this.initial=[]);return}if(a<this.q[0])this.q[0]=a,b=0;else if(a>=this.q[4])this.q[4]=a,b=3;else for(b=0;b<4&&a>=this.q[b+1];)b++;for(let a=b+1;a<5;a++)this.n[a]+=1;for(let a=0;a<5;a++)this.np[a]+=this.dn[a];for(let a=1;a<=3;a++){let b=this.np[a]-this.n[a];if(b>=1&&this.n[a+1]-this.n[a]>1||b<=-1&&this.n[a-1]-this.n[a]<-1){let c=Math.sign(b),d=this.q[a-1],e=this.q[a],f=this.q[a+1],g=this.n[a-1],h=this.n[a],i=this.n[a+1],j=c*(h-g+c)*(f-e)/(i-h)+c*(i-h-c)*(e-d)/(h-g),k=e+j/(i-g);(k<=d||k>=f)&&(k=e+c*(this.q[a+c]-e)/(this.n[a+c]-h)),this.q[a]=k,this.n[a]+=c}}}estimate(){return this.initialized?this.q[2]:this.initial.length?this.initial.sort((a,b)=>a-b)[Math.floor(this.initial.length*this.p)]:null}toSnapshot(){return{p:this.p,n:[...this.n],q:[...this.q],np:[...this.np],dn:[...this.dn],initialized:this.initialized,count:this.count,initial:[...this.initial]}}fromSnapshot(a){this.p=a.p,this.n=[...a.n],this.q=[...a.q],this.np=[...a.np],this.dn=[...a.dn],this.initialized=a.initialized,this.count=a.count,this.initial=[...a.initial]}}function f(a,b,c){let d=new e(.05,b||void 0),f=new e(.95,c||void 0);return d.update(a),f.update(a),{p5:d.toSnapshot(),p95:f.toSnapshot()}}},70818:(a,b,c)=>{"use strict";a.exports=c(44870)},92609:()=>{}};
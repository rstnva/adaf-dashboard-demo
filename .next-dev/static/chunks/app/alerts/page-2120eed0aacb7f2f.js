(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1484],{8141:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i,dynamic:()=>o});var s=t(51833),r=t(59693),l=t(37849);function n(){let[e,a]=(0,r.useState)([]),[t,n]=(0,r.useState)(1),[d,o]=(0,r.useState)(1),[i,c]=(0,r.useState)(50),[u,h]=(0,r.useState)("open"),[p,x]=(0,r.useState)("all"),[m,g]=(0,r.useState)("all"),[v,y]=(0,r.useState)(""),[b,j]=(0,r.useState)(!1),[f,N]=(0,r.useState)({open:!1,entity:"signal",refId:""}),w=(0,r.useCallback)(async()=>{j(!0);let e=new URLSearchParams;"open"===u&&e.set("open","1"),"ack"===u&&e.set("open","0"),"all"!==p&&e.set("type",p),"all"!==m&&e.set("severity",m),v&&e.set("q",v),e.set("page",String(t)),e.set("limit",String(i));let s=await fetch("/api/read/alerts?".concat(e.toString()),{cache:"no-store"}),r=await s.json();a(r.data),o(r.pages),j(!1)},[u,p,m,v,t,i]);(0,r.useEffect)(()=>{w()},[w]);let k=async e=>{await fetch("/api/actions/alerts/".concat(e,"/ack"),{method:"POST"}),w()},S=(0,r.useMemo)(()=>{let a=new Set;return e.forEach(e=>{var t;return(null==(t=e.signal)?void 0:t.type)&&a.add(e.signal.type)}),["all",...Array.from(a).sort()]},[e]);return(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-3",children:[(0,s.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:u,onChange:e=>h(e.target.value),children:[(0,s.jsx)("option",{value:"open",children:"Abiertas"}),(0,s.jsx)("option",{value:"ack",children:"Reconocidas"}),(0,s.jsx)("option",{value:"all",children:"Todas"})]}),(0,s.jsx)("select",{className:"border rounded px-2 py-1 text-sm",value:p,onChange:e=>x(e.target.value),children:S.map(e=>{var a;return(0,s.jsx)("option",{value:e,children:(null==(a=e.toUpperCase)?void 0:a.call(e))||e},e)})}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1 text-sm",value:m,onChange:e=>g(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Severidad (todas)"}),(0,s.jsx)("option",{value:"high",children:"HIGH"}),(0,s.jsx)("option",{value:"med",children:"MED"}),(0,s.jsx)("option",{value:"low",children:"LOW"})]}),(0,s.jsx)("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Buscar…",value:v,onChange:e=>y(e.target.value),onKeyDown:e=>"Enter"===e.key&&w()}),(0,s.jsx)("button",{onClick:w,className:"rounded border px-3 py-1 text-sm",children:b?"...":"Refrescar"}),(0,s.jsx)("div",{className:"ml-auto flex items-center gap-2",children:(0,s.jsx)("button",{onClick:()=>{let e=new URLSearchParams;"open"===u&&e.set("open","1"),"ack"===u&&e.set("open","0"),"all"!==p&&e.set("type",p),"all"!==m&&e.set("severity",m),v&&e.set("q",v),window.location.href="/api/read/alerts.csv?".concat(e.toString())},className:"rounded border px-3 py-1 text-sm",children:"Export CSV"})})]}),(0,s.jsx)("div",{className:"overflow-auto",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-left border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"py-2 pr-3",children:"Fecha"}),(0,s.jsx)("th",{className:"py-2 pr-3",children:"Tipo"}),(0,s.jsx)("th",{className:"py-2 pr-3",children:"T\xedtulo"}),(0,s.jsx)("th",{className:"py-2 pr-3",children:"Mensaje"}),(0,s.jsx)("th",{className:"py-2",children:"Acciones"})]})}),(0,s.jsxs)("tbody",{children:[e.map(e=>{var a,t;let r;return(0,s.jsxs)("tr",{className:"border-b last:border-0 ".concat("high"===(r=e.severity)?"bg-red-50/40 dark:bg-red-900/10":"low"===r?"bg-emerald-50/40 dark:bg-emerald-900/10":"bg-yellow-50/40 dark:bg-yellow-900/10"),children:[(0,s.jsx)("td",{className:"py-2 pr-3 whitespace-nowrap",children:new Date(e.createdAt).toLocaleString()}),(0,s.jsx)("td",{className:"py-2 pr-3",children:null==(a=e.signal)?void 0:a.type}),(0,s.jsxs)("td",{className:"py-2 pr-3 font-medium",children:[e.title,(e=>{let a=e||"med",t="high"===a?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-200":"low"===a?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200";return(0,s.jsx)("span",{className:"ml-2 text-2xs px-1.5 py-0.5 rounded ".concat(t),children:a.toUpperCase()})})(e.severity)]}),(0,s.jsx)("td",{className:"py-2 pr-3",children:e.description}),(0,s.jsx)("td",{className:"py-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.resolved?(0,s.jsx)("span",{className:"text-xs opacity-60",children:"OK"}):(0,s.jsx)("button",{onClick:()=>k(e.id),className:"rounded border px-2 py-1 text-xs",children:"ACK"}),(null==(t=e.signal)?void 0:t.id)&&(0,s.jsx)("button",{onClick:()=>N({open:!0,entity:"signal",refId:e.signal.id}),className:"rounded border px-2 py-1 text-xs bg-blue-50 text-blue-700 hover:bg-blue-100",title:"Ver lineage de la se\xf1al",children:"\uD83D\uDCCA Lineage"})]})})]},e.id)}),0===e.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"py-6 text-center opacity-70",colSpan:5,children:"Sin resultados"})})]})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,s.jsxs)("div",{className:"text-xs opacity-70",children:["P\xe1gina ",t," de ",d," — ",e.length," resultados (l\xedmite ",i,")"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{disabled:t<=1,onClick:()=>n(e=>Math.max(1,e-1)),className:"rounded border px-2 py-1 text-xs disabled:opacity-50",children:"← Anterior"}),(0,s.jsx)("button",{disabled:t>=d,onClick:()=>n(e=>Math.min(d,e+1)),className:"rounded border px-2 py-1 text-xs disabled:opacity-50",children:"Siguiente →"}),(0,s.jsx)("select",{className:"border rounded px-1 py-1 text-xs",value:i,onChange:e=>{c(Number(e.target.value)),n(1)},children:[25,50,100,200].map(e=>(0,s.jsxs)("option",{value:e,children:[e,"/p\xe1g"]},e))})]})]}),(0,s.jsx)(l.$,{open:f.open,onClose:()=>N(e=>({...e,open:!1})),entity:f.entity,refId:f.refId})]})}var d=t(98574);let o="force-dynamic";function i(){return(0,s.jsx)(d.NavigationGuard,{fallbackUrl:"/",storageKey:"alerts-view",children:(0,s.jsxs)("div",{className:"container mx-auto p-6 space-y-4",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Alertas"}),(0,s.jsx)(n,{})]})})}},8327:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(11097).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},71622:(e,a,t)=>{Promise.resolve().then(t.bind(t,8141))},83738:(e,a,t)=>{"use strict";var s=t(81678);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})},85127:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(11097).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},98574:(e,a,t)=>{"use strict";t.d(a,{NavigationGuard:()=>x});var s=t(51833),r=t(59693),l=t(30249),n=t.n(l),d=t(83738),o=t(11622),i=t(70994),c=t(8327),u=t(66846),h=t(85127),p=t(4991);function x(e){var a;let{hasUnsavedChanges:t=!1,onSave:l,data:x,storageKey:m,children:g,showBackButton:v=!0,backUrl:y,fallbackUrl:b="/"}=e,j=(0,d.useRouter)(),f=(0,d.usePathname)(),{toast:N}=(0,p.dj)(),[w,k]=(0,r.useState)(!1),[S,C]=(0,r.useState)(null),[A,E]=(0,r.useState)(!1),D=(0,r.useCallback)(async()=>{if(x&&m)try{let e={data:x,timestamp:Date.now(),pathname:f,expiresAt:Date.now()+2592e6};localStorage.setItem("adaf_autosave_".concat(m),JSON.stringify(e))}catch(e){console.warn("Failed to auto-save data:",e)}},[x,m,f]);(0,r.useEffect)(()=>{if(t&&x){let e=setInterval(D,3e4);return()=>clearInterval(e)}},[t,x,D]),(0,r.useEffect)(()=>{Object.keys(localStorage).filter(e=>e.startsWith("adaf_autosave_")).forEach(e=>{try{let a=JSON.parse(localStorage.getItem(e)||"{}");a.expiresAt&&a.expiresAt<Date.now()&&localStorage.removeItem(e)}catch(a){localStorage.removeItem(e)}})},[]);let P=(0,r.useCallback)(()=>y||(window.history.length>1?"back":b),[y,b]),L=(0,r.useMemo)(()=>P(),[P]),I="back"===L?null!=(a=null!=y?y:b)?a:"/":L;(0,r.useEffect)(()=>{let e=e=>{t&&(e.preventDefault(),e.returnValue="\xbfDesea salir sin guardar? Los datos se guardar\xe1n autom\xe1ticamente.",D())},a=e=>{t&&(e.preventDefault(),k(!0),C("back"),window.history.pushState(null,"",window.location.href))};return window.addEventListener("beforeunload",e),window.addEventListener("popstate",a),()=>{window.removeEventListener("beforeunload",e),window.removeEventListener("popstate",a)}},[t,D]);let M=async()=>{if(l){E(!0);try{await l(),N({title:"Datos guardados",description:"Los datos se han guardado correctamente."})}catch(e){N({title:"Error al guardar",description:"No se pudieron guardar los datos. Se guardar\xe1n autom\xe1ticamente.",variant:"destructive"})}finally{E(!1)}}await D(),k(!1);let e=null!=S?S:L;"back"===e?j.back():j.push(e)},R=async()=>{await D(),k(!1);let e=null!=S?S:L;"back"===e?j.back():j.push(e)};return(0,s.jsxs)(s.Fragment,{children:[v&&(t?(0,s.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:()=>{if(t){k(!0),C(L);return}"back"===L?j.back():j.push(L)},className:"mb-4 text-muted-foreground hover:text-foreground",children:[(0,s.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Regresar"]}):(0,s.jsx)(o.$,{asChild:!0,variant:"ghost",size:"sm",className:"mb-4 text-muted-foreground hover:text-foreground",children:(0,s.jsxs)(n(),{href:I,prefetch:!1,children:[(0,s.jsx)(c.A,{className:"w-4 h-4 mr-2"}),"Regresar"]})})),g,(0,s.jsx)(i.lG,{open:w,onOpenChange:k,children:(0,s.jsxs)(i.Cf,{children:[(0,s.jsxs)(i.c7,{children:[(0,s.jsxs)(i.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"w-5 h-5 text-destructive"}),"\xbfDesea salir de esta p\xe1gina?"]}),(0,s.jsxs)(i.rr,{children:["Tienes cambios sin guardar. \xbfQu\xe9 deseas hacer?",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground mt-2 block",children:"\uD83D\uDCA1 Los datos se guardan autom\xe1ticamente cada 30 segundos y se conservan por 30 d\xedas."})]})]}),(0,s.jsxs)(i.Es,{className:"gap-2",children:[(0,s.jsx)(o.$,{variant:"outline",onClick:()=>{k(!1),C(null)},children:"Quedarse"}),(0,s.jsx)(o.$,{variant:"secondary",onClick:R,children:"Salir sin guardar"}),(0,s.jsxs)(o.$,{onClick:M,disabled:A,className:"gap-2",children:[(0,s.jsx)(h.A,{className:"w-4 h-4"}),A?"Guardando...":"Guardar y salir"]})]})]})})]})}}},e=>{e.O(0,[3701,6333,249,3060,3389,4802,7913,5034,6266,9959,1413,7358],()=>e(e.s=71622)),_N_E=e.O()}]);
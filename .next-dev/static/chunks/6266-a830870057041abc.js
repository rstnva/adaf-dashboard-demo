"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6266],{1372:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(11097).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},2056:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(11097).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},9262:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(11097).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},31479:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(11097).A)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},33399:(e,t,a)=>{a.d(t,{E:()=>o});var s=a(51833);a(59693);var r=a(49639),n=a(81429);let l=(0,r.F)("inline-flex items-center rounded-full border border-amber-300/30 bg-amber-500/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-amber-100 shadow-[0_12px_30px_-18px_rgba(250,204,21,0.65)] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-amber-300/50 focus:ring-offset-2",{variants:{variant:{default:"border-amber-300/40 bg-amber-500/20 text-zinc-900 hover:bg-amber-400/30",secondary:"border-zinc-700/40 bg-zinc-900/60 text-amber-100/80 hover:bg-zinc-800/60",destructive:"border-rose-500/50 bg-rose-500/20 text-rose-100 hover:bg-rose-500/30",outline:"border-amber-200/40 bg-transparent text-amber-100/80 hover:border-amber-200/60"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...r})}},37849:(e,t,a)=>{a.d(t,{$:()=>E});var s=a(51833),r=a(59693),n=a(31479),l=a(66846),o=a(82952);let i=(0,a(11097).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var c=a(2056),d=a(1372),u=a(9262),m=a(81695),x=a(11622),h=a(33399);let p=e=>{let{open:t,children:a}=e;return(0,s.jsx)("div",{"data-state":t?"open":"closed",children:a})},g=r.forwardRef((e,t)=>{let{children:a,...r}=e;return(0,s.jsx)("button",{ref:t,...r,children:a})});g.displayName="CollapsibleTrigger";let f=r.forwardRef((e,t)=>{let{children:a,...r}=e;return(0,s.jsx)("div",{ref:t,...r,children:a})});f.displayName="CollapsibleContent";var b=a(81429);function v(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,b.cn)("animate-pulse rounded-md bg-slate-100",t),...a})}var j=a(93508),y=a(67356);function N(e){let{data:t,className:a="",maxHeight:n="300px"}=e,l=r.useMemo(()=>{try{return JSON.stringify(t,null,2)}catch(e){return"Error formatting JSON: ".concat(e instanceof Error?e.message:"Unknown error")}},[t]);return(0,s.jsx)("div",{className:"bg-slate-50 border rounded-md p-3 ".concat(a),style:{maxHeight:n,overflowY:"auto"},children:(0,s.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap text-slate-800 leading-relaxed",children:l})})}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Copiado al portapapeles";try{var a,s;if(null==(s=navigator)||null==(a=s.clipboard)?void 0:a.writeText){await navigator.clipboard.writeText(e);let a=document.createElement("div");return a.className="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg z-50 transition-all duration-300",a.textContent=t,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>document.body.removeChild(a),300)},2e3),!0}{let a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.left="-999999px",a.style.top="-999999px",document.body.appendChild(a),a.focus(),a.select();let s=document.execCommand("copy");if(document.body.removeChild(a),s){let e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg z-50",e.textContent=t,document.body.appendChild(e),setTimeout(()=>document.body.removeChild(e),2e3)}return s}}catch(t){console.error("Failed to copy to clipboard:",t);let e=document.createElement("div");return e.className="fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-md shadow-lg z-50",e.textContent="Error al copiar",document.body.appendChild(e),setTimeout(()=>document.body.removeChild(e),2e3),!1}}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return!e||e.length<=t+a+3?e:"".concat(e.substring(0,t),"…").concat(e.substring(e.length-a))}let C={ingest:{color:"bg-blue-100 text-blue-800 border-blue-200",icon:"\uD83D\uDCE5",label:"Ingesta"},transform:{color:"bg-purple-100 text-purple-800 border-purple-200",icon:"\uD83D\uDD04",label:"Transformaci\xf3n"},aggregate:{color:"bg-teal-100 text-teal-800 border-teal-200",icon:"\uD83D\uDCCA",label:"Agregaci\xf3n"},export:{color:"bg-gray-100 text-gray-800 border-gray-200",icon:"\uD83D\uDCE4",label:"Exportaci\xf3n"}};function E(e){let{open:t,onClose:a,entity:c,refId:d}=e,{data:u,isLoading:p,isError:g,error:f,refetch:b}=function(e){let{entity:t,refId:a,enabled:s=!0}=e;return(0,y.I)({queryKey:["lineage","trace",t,a],queryFn:async()=>{if(!("string"==typeof t&&["signal","metric","report"].includes(t)))throw Error("Invalid entity: ".concat(t,". Must be signal, metric, or report"));if(!a||0===a.trim().length)throw Error("refId is required and cannot be empty");let e=new URLSearchParams({entity:t,refId:a.trim()}),s=await fetch("/api/read/lineage/trace?".concat(e),{headers:{"Content-Type":"application/json"}});if(!s.ok)throw Error((await s.json().catch(()=>({}))).error||"HTTP ".concat(s.status,": Failed to fetch lineage trace"));let r=await s.json();if(!r.success)throw Error(r.error||"Failed to fetch lineage trace");return r},enabled:s&&!!t&&!!a,staleTime:3e4,retry:(e,t)=>!(t.message.includes("Invalid entity")||t.message.includes("HTTP 4"))&&e<2})}({entity:c,refId:d,enabled:t});(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t&&a()};if(t)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,a]),(0,r.useEffect)(()=>{t&&(null==u?void 0:u.success)&&fetch("/api/metrics/lineage/view",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity:c,refId:d})}).catch(()=>{})},[t,null==u?void 0:u.success,c,d]);let v=async e=>{await w(e,"Hash copiado al portapapeles")},N=async()=>{await w(d,"ID de referencia copiado")},C=k(d,8,6);return(0,s.jsx)(m.cj,{open:t,onOpenChange:a,children:(0,s.jsxs)(m.h,{className:"w-full sm:w-[540px] md:w-[640px] lg:w-[720px] max-w-none overflow-y-auto","aria-describedby":"lineage-drawer-description",children:[(0,s.jsxs)(m.Fm,{className:"space-y-3 pb-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(m.qp,{className:"flex items-center gap-2 text-lg",children:[(0,s.jsx)(n.A,{className:"w-5 h-5 text-slate-600"}),"Lineage"]}),(0,s.jsx)(x.$,{variant:"ghost",size:"sm",onClick:a,className:"h-8 w-8 p-0",children:(0,s.jsx)(l.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,s.jsx)(h.E,{variant:"outline",className:"capitalize",children:c}),(0,s.jsx)(o.A,{className:"w-3 h-3"}),(0,s.jsxs)(x.$,{variant:"ghost",size:"sm",onClick:N,className:"h-auto p-1 font-mono text-xs hover:bg-slate-100",children:[C,(0,s.jsx)(i,{className:"w-3 h-3 ml-1"})]})]})]}),(0,s.jsxs)("div",{id:"lineage-drawer-description",className:"sr-only",children:["Visualizaci\xf3n del lineage completo para ",c," con ID ",d,". Use las teclas de navegaci\xf3n para explorar los eventos y ESC para cerrar."]}),(0,s.jsxs)("div",{className:"py-4",children:[p&&(0,s.jsx)(T,{}),g&&(0,s.jsx)(j.F,{className:"mb-4",children:(0,s.jsxs)(j.T,{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{children:["Error al cargar lineage:"," ",(null==f?void 0:f.message)||"Error desconocido"]}),(0,s.jsx)(x.$,{variant:"outline",size:"sm",onClick:()=>b(),children:"Reintentar"})]})}),(null==u?void 0:u.success)&&u.trace&&(0,s.jsx)(z,{events:u.trace.events,onCopyHash:v}),(null==u?void 0:u.success)&&(!u.trace||0===u.trace.events.length)&&(0,s.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,s.jsx)(n.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"No se encontraron eventos de lineage para esta entidad."})]})]}),(0,s.jsx)("div",{className:"border-t pt-4 mt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[(0,s.jsx)("span",{children:(null==u?void 0:u.success)&&u.trace&&(0,s.jsxs)(s.Fragment,{children:[u.trace.events.length," eventos • \xdaltima actualizaci\xf3n:"," ",(e=>{try{return new Date(e).toLocaleString("es-ES",{dateStyle:"short",timeStyle:"medium"})}catch(t){return e}})(u.trace.lastEventAt)]})}),(0,s.jsx)(x.$,{variant:"outline",size:"sm",onClick:a,children:"Cerrar"})]})})]})})}function z(e){let{events:t,onCopyHash:a}=e,n=r.useMemo(()=>[...t].sort((e,t)=>new Date(e.ts).getTime()-new Date(t.ts).getTime()),[t]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h3",{className:"font-medium text-slate-900 flex items-center gap-2",children:[(0,s.jsx)(c.A,{className:"w-4 h-4"}),"Timeline de procesamiento (",n.length," eventos)"]}),(0,s.jsxs)("ul",{className:"space-y-4 relative",children:[(0,s.jsx)("div",{className:"absolute left-6 top-4 bottom-4 w-px bg-slate-200"}),n.map(e=>(0,s.jsx)(A,{event:e,onCopyHash:a},"".concat(e.id,"-").concat(e.ts)))]})]})}function A(e){let{event:t,onCopyHash:a}=e,[n,l]=r.useState(!1),o=C[t.stage],c=t.inputs&&Object.keys(t.inputs).length>0||t.outputs&&Object.keys(t.outputs).length>0;return(0,s.jsxs)("li",{className:"relative pl-12",children:[(0,s.jsx)("div",{className:"\n        absolute left-4 w-4 h-4 rounded-full border-2 bg-white\n        ".concat(o.color.includes("blue")?"border-blue-400":"","\n        ").concat(o.color.includes("purple")?"border-purple-400":"","\n        ").concat(o.color.includes("teal")?"border-teal-400":"","\n        ").concat(o.color.includes("gray")?"border-gray-400":"","\n      ")}),(0,s.jsxs)("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[(0,s.jsx)("div",{className:"flex items-start justify-between gap-3 mb-3",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)(h.E,{className:"".concat(o.color," text-xs"),children:[o.icon," ",o.label]}),(0,s.jsx)("span",{className:"text-xs text-slate-500",children:(e=>{try{return new Date(e).toLocaleString("es-ES",{dateStyle:"short",timeStyle:"medium"})}catch(t){return e}})(t.ts)})]}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium text-slate-700",children:"Fuente:"}),(0,s.jsx)("span",{className:"ml-2 font-mono text-xs bg-slate-50 px-2 py-1 rounded",children:t.source})]})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3 text-xs",children:[(0,s.jsx)("span",{className:"text-slate-500",children:"Hash:"}),(0,s.jsxs)(x.$,{variant:"ghost",size:"sm",onClick:()=>a(t.hash),className:"h-auto p-1 font-mono text-xs hover:bg-slate-100",children:[k(t.hash),(0,s.jsx)(i,{className:"w-3 h-3 ml-1"})]})]}),t.notes&&(0,s.jsxs)("div",{className:"text-xs text-slate-600 mb-3 p-2 bg-slate-50 rounded",children:[(0,s.jsx)("strong",{children:"Notas:"})," ",t.notes]}),c&&(0,s.jsxs)(p,{open:n,onOpenChange:l,children:[(0,s.jsxs)(g,{onClick:()=>l(!n),className:"h-auto p-2 text-xs w-full justify-between hover:bg-slate-50 flex items-center rounded border bg-white",children:[(0,s.jsx)("span",{children:"Ver inputs/outputs"}),n?(0,s.jsx)(d.A,{className:"w-3 h-3"}):(0,s.jsx)(u.A,{className:"w-3 h-3"})]}),(0,s.jsxs)(f,{className:"mt-3 space-y-3",children:[t.inputs&&Object.keys(t.inputs).length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-xs font-medium text-slate-700 mb-2",children:"Inputs:"}),(0,s.jsx)(N,{data:t.inputs,maxHeight:"200px"})]}),t.outputs&&Object.keys(t.outputs).length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-xs font-medium text-slate-700 mb-2",children:"Outputs:"}),(0,s.jsx)(N,{data:t.outputs,maxHeight:"200px"})]})]})]})]})]})}function T(){return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(c.A,{className:"w-4 h-4 text-slate-400"}),(0,s.jsx)(v,{className:"h-4 w-32"})]}),Array.from({length:3},(e,t)=>(0,s.jsxs)("div",{className:"relative pl-12",children:[(0,s.jsx)("div",{className:"absolute left-4 w-4 h-4 rounded-full bg-slate-200"}),(0,s.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)(v,{className:"h-5 w-20"}),(0,s.jsx)(v,{className:"h-4 w-24"})]}),(0,s.jsx)(v,{className:"h-4 w-full mb-2"}),(0,s.jsx)(v,{className:"h-4 w-3/4"})]})]},t))]})}},70994:(e,t,a)=>{a.d(t,{Cf:()=>u,Es:()=>x,L3:()=>h,c7:()=>m,lG:()=>o,rr:()=>p,zM:()=>i});var s=a(51833);a(59693);var r=a(87676),n=a(66846),l=a(81429);function o(e){let{...t}=e;return(0,s.jsx)(r.bL,{"data-slot":"dialog",...t})}function i(e){let{...t}=e;return(0,s.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function c(e){let{...t}=e;return(0,s.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function d(e){let{className:t,...a}=e;return(0,s.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,children:a,showCloseButton:o=!0,...i}=e;return(0,s.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,s.jsx)(d,{}),(0,s.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[a,o&&(0,s.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(n.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,l.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function x(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-footer",className:(0,l.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function h(e){let{className:t,...a}=e;return(0,s.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,l.cn)("text-lg leading-none font-semibold",t),...a})}function p(e){let{className:t,...a}=e;return(0,s.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,l.cn)("text-muted-foreground text-sm",t),...a})}},81695:(e,t,a)=>{a.d(t,{CG:()=>i,Fm:()=>m,Qs:()=>h,cj:()=>o,h:()=>u,qp:()=>x});var s=a(51833);a(59693);var r=a(87676),n=a(66846),l=a(81429);function o(e){let{...t}=e;return(0,s.jsx)(r.bL,{"data-slot":"sheet",...t})}function i(e){let{...t}=e;return(0,s.jsx)(r.l9,{"data-slot":"sheet-trigger",...t})}function c(e){let{...t}=e;return(0,s.jsx)(r.ZL,{"data-slot":"sheet-portal",...t})}function d(e){let{className:t,...a}=e;return(0,s.jsx)(r.hJ,{"data-slot":"sheet-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,children:a,side:o="right",...i}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(d,{}),(0,s.jsxs)(r.UC,{"data-slot":"sheet-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===o&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===o&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===o&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===o&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...i,children:[a,(0,s.jsxs)(r.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,s.jsx)(n.A,{className:"size-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"sheet-header",className:(0,l.cn)("flex flex-col gap-1.5 p-4",t),...a})}function x(e){let{className:t,...a}=e;return(0,s.jsx)(r.hE,{"data-slot":"sheet-title",className:(0,l.cn)("text-foreground font-semibold",t),...a})}function h(e){let{className:t,...a}=e;return(0,s.jsx)(r.VY,{"data-slot":"sheet-description",className:(0,l.cn)("text-muted-foreground text-sm",t),...a})}},82952:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(11097).A)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},93508:(e,t,a)=>{a.d(t,{F:()=>i,T:()=>c});var s=a(51833),r=a(59693),n=a(49639),l=a(81429);let o=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=r.forwardRef((e,t)=>{let{className:a,variant:r,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(o({variant:r}),a),...n})});i.displayName="Alert";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",a),...r})});c.displayName="AlertDescription"}}]);